# Dog Companion - Instru√ß√µes para Claude

## Vis√£o Geral do Projeto

Este √© um aplicativo Next.js 16 para gerenciar fichas de personagens de D&D. Possui dois tipos de personagens:
- **Detetive**: Com um companheiro canino (C√£o)
- **Soldado**: Com uma arma sentiente (Espada)

## Tecnologias

- **Next.js 16** com App Router e Turbopack
- **TypeScript** (strict mode)
- **Tailwind CSS v4**
- **React 19**
- **LocalStorage** para persist√™ncia de dados

## Estrutura de Pastas

```
app/
‚îú‚îÄ‚îÄ components/          # Componentes reutiliz√°veis
‚îú‚îÄ‚îÄ detetive/
‚îÇ   ‚îî‚îÄ‚îÄ cao/            # P√°gina do companheiro canino
‚îî‚îÄ‚îÄ soldado/
    ‚îî‚îÄ‚îÄ espada/         # P√°gina da espada sentiente

types/
‚îú‚îÄ‚îÄ companion.ts        # Tipos do c√£o (Detetive)
‚îî‚îÄ‚îÄ sword.ts            # Tipos da espada (Soldado)
```

## Componentes Reutiliz√°veis Padronizados

**IMPORTANTE**: Sempre utilize estes componentes quando aplic√°vel. N√ÉO recrie l√≥gica inline que j√° existe nesses componentes.

### 1. Layout e Cabe√ßalhos

#### `ItemHeader`
Para cabe√ßalhos de personagens/itens com n√≠vel, imagem, e edi√ß√£o de nome.
```tsx
<ItemHeader
  itemName="Nome"
  itemType="Tipo"
  itemLevel={level}
  itemSubtitle="Subt√≠tulo"
  itemAlignment="Alinhamento"
  itemDescription="Descri√ß√£o"
  themeColor="amber" | "red"
  maxLevel={10}
  icon={<svg>...</svg>}
  onNameChange={handleNameChange}
  allowNameEdit={true}
/>
```

#### `SectionHeader`
Para t√≠tulos de se√ß√£o com √≠cone.
```tsx
<SectionHeader
  icon="üß≠"
  title="T√≠tulo"
  themeColor="amber" | "red"
/>
```

#### `ContentBox`
Container com t√≠tulo opcional para agrupar conte√∫do relacionado.
```tsx
<ContentBox title="T√≠tulo" icon="üìú" themeColor="amber" | "red">
  {children}
</ContentBox>
```

### 2. Estat√≠sticas e Atributos

#### `StatCard`
Para exibir estat√≠sticas (PV, CA, Deslocamento, etc).
```tsx
<StatCard
  label="PV"
  value="10/20"
  color="red" | "blue" | "green" | "amber" | "purple"
  interactive={{
    onDecrease: () => {},
    onIncrease: () => {}
  }}
/>
```

#### `AttributeGrid`
Grade de 6 atributos de D&D (FOR, DES, CON, INT, SAB, CAR).
```tsx
<AttributeGrid
  attributes={companion.attributes}
  themeColor="amber" | "red"
/>
```

### 3. Habilidades

**‚ö†Ô∏è IMPORTANTE**: Use **APENAS** `EnhancedAbilityCard` para exibir habilidades. Os componentes `BaseAbilityCard`, `AbilityCard` e `AbilitySelectionCard` s√£o OBSOLETOS e devem ser evitados.

#### `EnhancedAbilityCard` ‚úÖ (PREFERIDO)
Componente √∫nico e padronizado para exibir TODAS as habilidades em TODOS os contextos (combate, progress√£o, sele√ß√£o).

**Caracter√≠sticas:**
- Suporta todos os detalhes de D&D 5e (tipo de a√ß√£o, alcance, dura√ß√£o, dano, testes, condi√ß√µes, limites, custos)
- Funciona para habilidades fixas, selecion√°veis ou j√° selecionadas
- Exibi√ß√£o consistente em todas as abas (Combate e Progress√£o)
- Suporta modo de sele√ß√£o (clic√°vel) ou apenas exibi√ß√£o

**Props:**
```tsx
<EnhancedAbilityCard
  // B√°sico (obrigat√≥rio)
  name="Nome da Habilidade"
  description="Descri√ß√£o completa"
  type="passive" | "active" | "reaction"
  isUnlocked={true}
  isSelected={false}
  canSelect={false}
  themeColor="amber" | "red" | "purple"

  // Detalhes D&D 5e (opcional)
  actionType="action" | "bonus" | "reaction" | "free" | "none"
  range="9 metros"
  duration="1 turno"
  damageType="Necr√≥tico"
  damage="+1d6"
  savingThrow="Destreza CD 14"
  condition="Preso por 1 turno"
  limit="1/descanso curto"
  cost="1d4 de dano necr√≥tico"

  // Para habilidades selecion√°veis
  onClick={() => selectAbility(ability)}
/>
```

**Exemplo - Habilidade fixa (n√≠vel 1-2):**
```tsx
<EnhancedAbilityCard
  name="C√£o Investigador"
  description="Vantagem em Percep√ß√£o/Investiga√ß√£o..."
  type="passive"
  actionType="none"
  range="9 metros"
  isUnlocked={true}
  isSelected={false}
  canSelect={false}
  themeColor="amber"
/>
```

**Exemplo - Habilidade selecion√°vel:**
```tsx
<EnhancedAbilityCard
  name="Grito da Forja"
  description="O usu√°rio desperta os ecos..."
  type="active"
  actionType="bonus"
  duration="At√© o fim do turno"
  damage="+1d6 em todos os ataques"
  damageType="Necr√≥tico"
  cost="1d4 de dano necr√≥tico"
  limit="1x por descanso curto"
  isUnlocked={level >= 3}
  isSelected={selectedAbility?.id === ability.id}
  canSelect={level >= 3 && !readOnly}
  onClick={() => selectAbility(ability)}
  themeColor="red"
/>
```

#### ~~`BaseAbilityCard`~~ ‚ùå OBSOLETO
Usar `EnhancedAbilityCard` ao inv√©s.

#### ~~`AbilityCard`~~ ‚ùå OBSOLETO
Usar `EnhancedAbilityCard` ao inv√©s.

#### ~~`AbilitySelectionCard`~~ ‚ùå OBSOLETO
Usar `EnhancedAbilityCard` ao inv√©s.

#### `LevelSectionHeader`
Para cabe√ßalhos de se√ß√µes de n√≠vel com status.
```tsx
<LevelSectionHeader
  level={3}
  title="Escolha de Caminho"
  isLocked={!canSelect}
  isPending={canSelect && !selectedAbility}
/>
```

#### `PathInfoCard`
Para cards informativos sobre caminhos/tipos de habilidades.
```tsx
<PathInfoCard
  icon="‚öîÔ∏è"
  title="Presa Firme"
  subtitle="ofensivo"
  description="Focado em causar dano..."
  borderColor="border-red-700/50"
  bgGradient="from-red-950/20"
/>
```

### 4. Avisos e Notifica√ß√µes

#### `WarningBanner`
Para avisos de habilidades pendentes ou outras notifica√ß√µes.
```tsx
<WarningBanner
  title="Habilidades Pendentes"
  message="Voc√™ tem habilidades n√£o selecionadas..."
  buttonText="Ir para Habilidades"
  onButtonClick={() => setActiveTab('abilities')}
/>
```

### 5. Navega√ß√£o

#### `TabNavigation`
Para abas de navega√ß√£o com scroll horizontal no mobile.
```tsx
<TabNavigation
  tabs={[
    { id: 'combat', label: 'Combate', icon: '‚öîÔ∏è' },
    { id: 'abilities', label: 'Habilidades', icon: 'üß≠', badge: 2 },
    { id: 'hp', label: 'Pontos de Vida', icon: '‚ù§Ô∏è' },
  ]}
  activeTab={activeTab}
  onTabChange={(tabId) => setActiveTab(tabId)}
  themeColor="amber" | "red"
/>
```

#### `EquipmentTabs`
Para abas de equipamentos/itens com scroll horizontal no mobile.
```tsx
<EquipmentTabs
  equipments={DETETIVE_EQUIPMENTS}
  selectedId={selectedEquipment}
  onSelect={handleEquipmentSelect}
/>
```

### 6. Level-Up

#### `LevelUpModal`
Modal centralizada para gerenciar level-up de m√∫ltiplos equipamentos simultaneamente.

**Caracter√≠sticas:**
- Coleta dados de HP roll, aumentos de atributo e sele√ß√£o de habilidades
- Suporta m√∫ltiplos equipamentos em uma √∫nica modal
- Valida√ß√£o autom√°tica de campos obrigat√≥rios
- Responsivo e mobile-first

**Como usar nas p√°ginas de personagem:**
```tsx
// 1. Importar tipos e modal
import LevelUpModal from '../components/LevelUpModal';
import { LevelUpRequirement, LevelUpData } from '@/types/levelup';
import CaoPage, { CaoPageRef } from './cao/page';

// 2. Estados e refs
const [showLevelUpModal, setShowLevelUpModal] = useState(false);
const [levelUpRequirements, setLevelUpRequirements] = useState<LevelUpRequirement[]>([]);
const [pendingLevel, setPendingLevel] = useState<number | null>(null);
const caoPageRef = useRef<CaoPageRef>(null);

// 3. Coletar requirements no handleLevelChange
const handleLevelChange = (newLevel: number) => {
  if (newLevel > characterLevel) {
    setPendingLevel(newLevel);
    const requirements: LevelUpRequirement[] = [];

    const caoReq = caoPageRef.current?.getLevelUpRequirement(newLevel);
    if (caoReq) requirements.push(caoReq);

    if (requirements.length > 0) {
      setLevelUpRequirements(requirements);
      setShowLevelUpModal(true);
    }
  }
};

// 4. Distribuir dados ao confirmar
const handleLevelUpConfirm = (allData: LevelUpData[]) => {
  allData.forEach((data) => {
    if (data.equipmentId === 'cao') {
      caoPageRef.current?.confirmLevelUp(data);
    }
  });
  setCharacterLevel(pendingLevel!);
  setShowLevelUpModal(false);
};

// 5. Renderizar modal e equipamentos com ref
<CaoPage ref={caoPageRef} level={effectiveLevel} />

{showLevelUpModal && (
  <LevelUpModal
    requirements={levelUpRequirements}
    onConfirm={handleLevelUpConfirm}
    onCancel={handleLevelUpCancel}
    themeColor="amber"
  />
)}
```

**Como implementar em p√°ginas de itens:**
```tsx
// 1. Usar forwardRef e expor interface
import { useImperativeHandle, forwardRef } from 'react';
import { LevelUpRequirement, LevelUpData } from '@/types/levelup';

export interface CaoPageRef {
  getLevelUpRequirement: (level: number) => LevelUpRequirement | null;
  confirmLevelUp: (data: LevelUpData) => void;
}

const CaoPage = forwardRef<CaoPageRef, Props>(function CaoPage(props, ref) {
  // 2. Implementar getLevelUpRequirement
  const getLevelUpRequirement = (targetLevel: number): LevelUpRequirement | null => {
    // Retornar requirement ou null se n√£o precisar de modal
    return {
      equipmentId: 'cao',
      equipmentName: 'C√£o de Guarda',
      equipmentIcon: 'üêï',
      level: targetLevel,
      hpRoll: { diceType: 'd6', currentModifier: attributes.constitution.modifier },
      attributeIncrease: { count: 2, currentAttributes: attributes },
    };
  };

  // 3. Implementar confirmLevelUp
  const handleConfirmLevelUp = (data: LevelUpData) => {
    // Processar dados e atualizar estado
    if (data.hpRoll) {
      // Adicionar HP
    }
    if (data.attributeIncrease) {
      // Aumentar atributos
    }
  };

  // 4. Expor via useImperativeHandle
  useImperativeHandle(ref, () => ({
    getLevelUpRequirement,
    confirmLevelUp: handleConfirmLevelUp,
  }), [dependencies]);
});

export default CaoPage;
```

## Padr√µes de P√°gina

### Estrutura Padr√£o de P√°gina de Personagem

```tsx
'use client';

import { useState, useEffect } from 'react';
import { /* types */ } from '@/types/...';
import ItemHeader from '@/app/components/ItemHeader';
import StatCard from '@/app/components/StatCard';
import AttributeGrid from '@/app/components/AttributeGrid';
import WarningBanner from '@/app/components/WarningBanner';
import SectionHeader from '@/app/components/SectionHeader';
import ContentBox from '@/app/components/ContentBox';
import AbilityCard from '@/app/components/AbilityCard';
import BaseAbilityCard from '@/app/components/BaseAbilityCard';
import AbilitySelectionCard from '@/app/components/AbilitySelectionCard';
import LevelSectionHeader from '@/app/components/LevelSectionHeader';
import PathInfoCard from '@/app/components/PathInfoCard';
import TabNavigation from '@/app/components/TabNavigation';

export default function CharacterPage({ level, onLevelChange }) {
  const [activeTab, setActiveTab] = useState<'combat' | 'abilities'>('combat');
  const [isLoaded, setIsLoaded] = useState(false);
  const [character, setCharacter] = useState(/* initial state */);

  // LocalStorage: Load on mount
  useEffect(() => {
    const saved = localStorage.getItem('character-key');
    if (saved) {
      try {
        setCharacter(JSON.parse(saved));
      } catch (e) {
        console.error('Failed to load data:', e);
      }
    }
    setIsLoaded(true);
  }, []);

  // LocalStorage: Save on changes
  useEffect(() => {
    if (isLoaded) {
      localStorage.setItem('character-key', JSON.stringify(character));
    }
  }, [character, isLoaded]);

  // Sync level with prop
  useEffect(() => {
    if (isLoaded && level !== character.level) {
      handleLevelChange(level);
    }
  }, [level, isLoaded]);

  // Prevent hydration mismatch
  if (!isLoaded) {
    return (
      <div className="min-h-screen bg-neutral-950 text-neutral-100">
        <div className="mx-auto flex min-h-screen max-w-4xl items-center justify-center">
          <div className="text-amber-100">Carregando...</div>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-neutral-950 text-neutral-100">
      <div className="mx-auto max-w-4xl px-4 py-6 sm:py-8">
        {/* Header com ItemHeader */}
        <ItemHeader {...headerProps} />

        {/* Stats com StatCard */}
        <div className="mb-6 grid grid-cols-2 gap-3 sm:grid-cols-3">
          <StatCard {...statProps} />
        </div>

        {/* Attributes com AttributeGrid */}
        <AttributeGrid {...attributeProps} />

        {/* Warning com WarningBanner se necess√°rio */}
        {hasWarning && <WarningBanner {...warningProps} />}

        {/* Tabs com TabNavigation */}
        <TabNavigation
          tabs={tabs}
          activeTab={activeTab}
          onTabChange={setActiveTab}
          themeColor="amber"
        />

        {/* Tab Content */}
        {activeTab === 'combat' && (
          <div className="space-y-6">
            <ContentBox title="Habilidades Ativas" icon="üìú" themeColor="amber">
              <div className="space-y-3">
                {/* AbilityCard components */}
              </div>
            </ContentBox>
          </div>
        )}

        {activeTab === 'abilities' && (
          <div className="space-y-6">
            {/* PathInfoCard grid se aplic√°vel */}
            <ContentBox title="Caminhos de Evolu√ß√£o" icon="üõ§Ô∏è" themeColor="amber">
              <div className="grid gap-3 sm:grid-cols-3">
                <PathInfoCard {...pathProps} />
              </div>
            </ContentBox>

            {/* Base Abilities */}
            <div className="space-y-3">
              <SectionHeader icon="üß≠" title="Habilidades de Classe" themeColor="amber" />
              <BaseAbilityCard {...baseAbilityProps} />
            </div>

            {/* Ability Selection */}
            {levels.map((level) => (
              <div key={level}>
                <LevelSectionHeader {...headerProps} />
                <div className="space-y-2">
                  {abilities.map((ability) => (
                    <AbilitySelectionCard key={ability.id} {...selectionProps} />
                  ))}
                </div>
              </div>
            ))}
          </div>
        )}
      </div>
    </div>
  );
}
```

## Conven√ß√µes de C√≥digo

### Cores por Tema

- **Detetive (C√£o)**: `themeColor="amber"`
- **Soldado (Espada)**: `themeColor="red"`

### Extra√ß√£o de Cores de Strings

Quando trabalhar com `PATH_COLORS` ou `ABILITY_TYPE_COLORS`:

```tsx
// CORRETO ‚úÖ
const pathColor = PATH_COLORS[ability.path]; // "border-red-700/50 bg-red-950/20"
const [borderColor, bgColor] = pathColor.split(' ');

// INCORRETO ‚ùå
const borderColor = pathColor.split(' ')[1]; // pega o √≠ndice errado
```

### LocalStorage

- Sempre usar `isLoaded` state para prevenir hydration mismatch
- Salvar no useEffect com depend√™ncia `[state, isLoaded]`
- Exibir "Carregando..." enquanto `!isLoaded`

### Tabs

Padr√£o de 2-3 abas:
- **Combate**: Estat√≠sticas e habilidades ativas
- **Habilidades/Despertares**: Sele√ß√£o de habilidades por n√≠vel
- **Pontos de Vida** (opcional): Hist√≥rico de HP

## Padroniza√ß√£o de Dados de Habilidades

**‚ö†Ô∏è CR√çTICO**: TODAS as habilidades devem ser definidas em arrays centralizados nos arquivos de tipos, NUNCA hardcoded nos componentes.

### Estrutura Obrigat√≥ria

Cada item/personagem deve ter:

1. **Array de habilidades** em `types/[nome].ts`:
```tsx
export type AbilityType = {
  id: string;
  name: string;
  description: string;
  type: 'passive' | 'active' | 'reaction';
  level: number; // ou awakening: number
  // Detalhes D&D 5e
  actionType?: 'action' | 'bonus' | 'reaction' | 'free' | 'none';
  range?: string;
  duration?: string;
  damageType?: string;
  damage?: string;
  savingThrow?: string;
  condition?: string;
  limit?: string;
  cost?: string;
};

export const ABILITIES: AbilityType[] = [
  {
    id: 'ability-1',
    name: 'Nome',
    description: 'Descri√ß√£o completa...',
    type: 'passive',
    level: 1,
    actionType: 'none',
    range: '9 metros',
    // ... todos os campos relevantes
  },
  // ... mais habilidades
];
```

2. **Uso nas p√°ginas** - buscar SEMPRE do array:

**‚úÖ CORRETO - Aba Combate:**
```tsx
// Buscar habilidades base do array
const allAbilities = [];
if (level >= 1) {
  const ability = ABILITIES.find(a => a.level === 1);
  if (ability) allAbilities.push(ability);
}
// Adicionar habilidades selecionadas
if (selectedAbilities.level3) allAbilities.push(selectedAbilities.level3);

// Renderizar
{allAbilities.map(ability => (
  <EnhancedAbilityCard
    key={ability.id}
    name={ability.name}
    description={ability.description}
    type={ability.type}
    actionType={ability.actionType}
    range={ability.range}
    // ... passar TODOS os campos do objeto
    isUnlocked={true}
    isSelected={false}
    canSelect={false}
    themeColor="amber"
  />
))}
```

**‚úÖ CORRETO - Aba Progress√£o (n√≠veis fixos):**
```tsx
{ABILITIES.filter(a => a.level === 1).map(ability => (
  <EnhancedAbilityCard
    key={ability.id}
    name={ability.name}
    description={ability.description}
    type={ability.type}
    actionType={ability.actionType}
    // ... passar TODOS os campos
    isUnlocked={level >= 1}
    isSelected={false}
    canSelect={false}
    themeColor="amber"
  />
))}
```

**‚úÖ CORRETO - Aba Progress√£o (selecion√°veis):**
```tsx
{ABILITIES.filter(a => a.level === 3).map(ability => {
  const isSelected = selectedAbilities.level3?.id === ability.id;
  return (
    <EnhancedAbilityCard
      key={ability.id}
      name={ability.name}
      description={ability.description}
      type={ability.type}
      actionType={ability.actionType}
      // ... passar TODOS os campos
      isUnlocked={level >= 3}
      isSelected={isSelected}
      canSelect={level >= 3 && !readOnly}
      onClick={() => selectAbility(ability)}
      themeColor="amber"
    />
  );
})}
```

**‚ùå ERRADO - Hardcoded:**
```tsx
// N√ÉO FAZER ISSO!
<EnhancedAbilityCard
  name="C√£o Investigador"
  description="Vantagem em Percep√ß√£o..."
  type="passive"
  // ... props hardcoded
/>
```

### Benef√≠cios da Padroniza√ß√£o

1. **Consist√™ncia**: Mesmos dados nas abas Combate e Progress√£o
2. **Manutenibilidade**: Alterar dados em um √∫nico lugar
3. **Escalabilidade**: Adicionar novos campos sem modificar componentes
4. **Tipagem**: TypeScript garante que todos os campos s√£o v√°lidos

### Exemplos de Refer√™ncia

- **Espada**: `types/sword.ts` ‚Üí `SWORD_ABILITIES`
- **Grim√≥rio**: `types/grimorio.ts` ‚Üí `GRIMORIO_ABILITIES`
- **C√£o**: `types/companion.ts` ‚Üí `BASE_COMPANION_ABILITIES`

## Regras Importantes

1. **SEMPRE** use componentes reutiliz√°veis quando aplic√°vel
2. **N√ÉO** crie JSX inline que replique a funcionalidade de um componente existente
3. **SEMPRE** extraia cores de constantes tipadas (`PATH_COLORS`, `ABILITY_TYPE_COLORS`)
4. **SEMPRE** use `themeColor` prop para manter consist√™ncia visual
5. **SEMPRE** implemente LocalStorage com `isLoaded` guard
6. **SEMPRE** sincronize level prop com state interno
7. **N√ÉO** use emojis a menos que explicitamente solicitado
8. **SEMPRE** prefira editar arquivos existentes ao inv√©s de criar novos
9. **SEMPRE** pense mobile-first ao criar novos componentes
   - Use tamanhos menores como padr√£o e escale com `sm:`, `md:`, `lg:`
   - Teste responsividade em telas pequenas (320px+)
   - Use `overflow-x-auto` quando necess√°rio para scroll horizontal
   - Adicione `min-w-0` para prevenir overflow de texto
   - Use `flex-col` para mobile e `sm:flex-row` para desktop
10. **SEMPRE** que um componente novo for criado, adicione-o √† documenta√ß√£o do `.claude.md`
    - Adicione descri√ß√£o clara do prop√≥sito do componente
    - Liste todas as props com seus tipos
    - Forne√ßa exemplo de uso completo
    - Indique quando usar e quando n√£o usar o componente
11. **SEMPRE** defina habilidades em arrays centralizados em `types/`, NUNCA hardcoded
12. **SEMPRE** use `EnhancedAbilityCard` para exibir habilidades (componentes antigos s√£o obsoletos)
13. **SEMPRE** passe TODOS os campos do objeto de habilidade para o `EnhancedAbilityCard`
14. **SEMPRE** busque habilidades dos arrays usando `.find()`, `.filter()` e `.map()`

## Pr√≥ximas P√°ginas/Personagens

Ao criar novos personagens ou itens:

1. Criar tipos em `types/[nome].ts`
2. Criar p√°gina em `app/[tipo]/[nome]/page.tsx`
3. Seguir a estrutura padr√£o de p√°gina acima
4. Reutilizar TODOS os componentes aplic√°veis
5. Manter consist√™ncia com cores tem√°ticas
6. Adicionar rota no componente de navega√ß√£o principal

## Exemplos de Refer√™ncia

- **Detetive (C√£o)**: `app/detetive/cao/page.tsx`
- **Soldado (Espada)**: `app/soldado/espada/page.tsx`
